{"version":3,"sources":["../../src/lib/opml.js"],"names":[],"mappings":";;AAAA,IAAM,MAAM,QAAQ,KAAR,CAAZ;AACA,IAAM,KAAK,QAAQ,IAAR,CAAX;AACA,IAAM,MAAM,QAAQ,KAAR,CAAZ;AACA,IAAM,SAAS,QAAQ,QAAR,CAAf;AACA,IAAM,KAAK,QAAQ,IAAR,CAAX;AACA,IAAM,IAAI,GAAG,UAAb;;AAEA,OAAO,OAAP,GAAiB;AACf,QADe,mBACP,IADO,EACD;AACZ,WAAO;AAAA,UAAG,UAAH,QAAG,UAAH;AAAA,aACL,EAAE,MAAF,CAAS,aAAK;AACZ,YAAM,YAAY,IAAI,YAAJ,EAAlB;AACA,YAAM,QAAQ,EAAd;AACA,WAAG,gBAAH,CAAoB,IAApB,EACG,IADH,CACQ,SADR;AAEA,kBAAU,EAAV,CAAa,SAAb,EAAwB,aAAK;AAC3B,cAAI,EAAE,IAAF,KAAW,SAAf,EAA0B;AAC1B,gBAAM,IAAN,CAAW,WAAW,EAAE,UAAF,CAAa,MAAb,IAAuB,EAAE,UAAF,CAAa,GAA/C,EAAoD,EAApD,CAAX;AACD,SAHD;AAIA,kBAAU,EAAV,CAAa,KAAb,EAAoB;AAAA,iBAClB,EAAE,QAAF,CAAW,KAAX,EACG,SADH,CAEI;AAAA,mBAAK,EAAE,MAAF,CAAS,CAAT,CAAL;AAAA,WAFJ,EAGI;AAAA,mBAAO,EAAE,OAAF,CAAU,GAAV,CAAP;AAAA,WAHJ,EAII;AAAA,mBAAM,EAAE,WAAF,EAAN;AAAA,WAJJ,CADkB;AAAA,SAApB;AAQA,kBAAU,EAAV,CAAa,OAAb,EAAsB;AAAA,iBAAO,EAAE,OAAF,CAAU,GAAV,CAAP;AAAA,SAAtB;AACD,OAlBD,CADK;AAAA,KAAP;AAoBD,GAtBc;AAuBf,QAvBe,0BAuBQ;AAAA,QAAb,SAAa,SAAb,SAAa;;AACrB,WACE,YACG,GADH,CACO;AAAA,aAAS,IAAI;AAChB,cAAM,CACJ,EAAC,OAAO,EAAE,SAAS,KAAX,EAAR,EADI,EAEJ,EAAC,MAAM,CACL,EAAC,OAAO,WAAR,EADK,EAEL,EAAC,aAAa,SAAS,GAAT,GAAe,MAAf,CAAsB,2BAAtB,CAAd,EAFK,CAAP,EAFI,EAMJ,EAAC,MAAM,MAAM,GAAN,CAAU;AAAA,mBACd,EAAE,SAAS,CAAC,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAF,CAAM,KAAN,CAAV,EAAT,EAAD,CAAX,EADc;AAAA,WAAV,CAAP,EANI;AADU,OAAJ,EAWX,EAAC,aAAa,IAAd,EAXW,CAAT;AAAA,KADP,CADF;AAeD;AAvCc,CAAjB","file":"opml.js","sourcesContent":["const sax = require('sax')\nconst fs = require('fs')\nconst xml = require('xml')\nconst moment = require('moment')\nconst Rx = require('rx')\nconst O = Rx.Observable\n\nmodule.exports = {\n  import (file) {\n    return ({ insertFeed }) =>\n      O.create(o => {\n        const saxStream = sax.createStream()\n        const tasks = []\n        fs.createReadStream(file)\n          .pipe(saxStream)\n        saxStream.on('opentag', t => {\n          if (t.name !== 'OUTLINE') return\n          tasks.push(insertFeed(t.attributes.XMLURL || t.attributes.URL, []))\n        })\n        saxStream.on('end', () =>\n          O.forkJoin(tasks)\n            .subscribe(\n              v => o.onNext(v),\n              err => o.onError(err),\n              () => o.onCompleted()\n            )\n        )\n        saxStream.on('error', err => o.onError(err))\n      })\n  },\n  export ({ listFeeds }) {\n    return (\n      listFeeds()\n        .map(feeds => xml({\n          opml: [\n            {_attr: { version: '1.1' }},\n            {head: [\n              {title: 'RSS-o-Bot'},\n              {dateCreated: moment().utc().format('dd D YYYY at HH:MM:SS UTC')}\n            ]},\n            {body: feeds.map(f =>\n              ({ outline: [{ _attr: { xmlUrl: f.get('url') } }] })\n            )}\n          ]\n        }, {declaration: true}))\n    )\n  }\n}\n\n"]}