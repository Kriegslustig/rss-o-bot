{"version":3,"sources":["../../src/lib/notify.js"],"names":[],"mappings":";;AAAA,IAAM,KAAK,QAAQ,IAAR,CAAX;AACA,IAAM,KAAK,QAAQ,SAAR,CAAX;AACA,IAAM,WAAW,QAAQ,eAAR,CAAjB;;AAEA,OAAO,OAAP,GAAiB,UAAC,MAAD,EAAY;AAC3B,MAAM,QACJ,OAAO,sBAAP,EAA+B,GAA/B,CAAmC,aAAK;AACtC,QAAI,MAAM,UAAV,EAAsB,OAAO,SAAS,MAAT,CAAP;AACtB,QAAI,MAAM,SAAV,EAAqB,OAAO,QAAQ,MAAR,CAAP;AACtB,GAHD,CADF;AAKA,SAAO,UAAC,IAAD,EAAO,IAAP;AAAA,WACL,GAAG,UAAH,CAAc,QAAd,CACE,MAAM,GAAN,CAAU;AAAA,aAAK,EAAK,IAAL,6BAAmC,IAAnC,CAAL;AAAA,KAAV,CADF,CADK;AAAA,GAAP;AAID,CAVD;;AAYA,SAAS,QAAT,CAAmB,MAAnB,EAA2B;AACzB,MAAM,KAAK,GAAG,OAAO,oBAAP,CAAH,CAAX;AACA,SAAO,UAAC,OAAD,EAAU,OAAV;AAAA,WACL,GAAG,UAAH,CAAc,QAAd,CACE,OAAO,qBAAP,EAA8B,GAA9B,CAAkC;AAAA,aAChC,GAAG,UAAH,CAAc,WAAd,CAA0B,GAAG,WAAH,CAAe,CAAf,EAAqB,OAArB,WAAkC,OAAlC,CAA1B,CADgC;AAAA,KAAlC,CADF,CADK;AAAA,GAAP;AAMD;;AAED,SAAS,OAAT,CAAkB,MAAlB,EAA0B;AACxB,MAAM,SAAS,GAAG,UAAH,CAAc,gBAAd,CAA+B,SAAS,MAAT,CAAgB,IAAhB,CAAqB,QAArB,CAA/B,CAAf;AACA,SAAO,UAAC,KAAD,EAAQ,IAAR;AAAA,WAAiB,OAAO;AAC7B,kBAD6B,EACtB,UADsB,EAChB,MAAM;AADU,KAAP,EAErB,iBAFqB,CAEH,IAFG,CAAjB;AAAA,GAAP,C;AAGD","file":"notify.js","sourcesContent":["const Rx = require('rx')\nconst Tg = require('tg-yarl')\nconst notifier = require('node-notifier')\n\nmodule.exports = (config) => {\n  const sends =\n    config['notification-methods'].map(m => {\n      if (m === 'telegram') return telegram(config)\n      if (m === 'desktop') return desktop(config)\n    })\n  return (blog, link) =>\n    Rx.Observable.forkJoin(\n      sends.map(f => f(`${blog} posted something new.`, link))\n    )\n}\n\nfunction telegram (config) {\n  const tg = Tg(config['telegram-api-token'])\n  return (subject, message) =>\n    Rx.Observable.forkJoin(\n      config['telegram-recipients'].map(r =>\n        Rx.Observable.fromPromise(tg.sendMessage(r, `${subject} \\n${message}`))\n      )\n    )\n}\n\nfunction desktop (config) {\n  const notify = Rx.Observable.fromNodeCallback(notifier.notify.bind(notifier))\n  return (title, text) => notify({\n    title, text, open: text\n  }).takeUntilWithTime(1000) // Time out gracefully if nothing happens\n}\n\n"]}